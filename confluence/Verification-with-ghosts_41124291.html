<!DOCTYPE html>
<html>
    <head>
        <title>Certora Prover Documentation : Verification with ghosts</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Certora Prover Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Certora-Prover-Documentation_2916669.html">Certora Prover Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Specification-By-Example_5243036.html">Specification By Example</a></span>
                            </li>
                                                    <li>
                                <span><a href="41255215.html">The (Iterable) Map</a></span>
                            </li>
                                                    <li>
                                <span><a href="An-Iterable-Map_41124276.html">An Iterable Map</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Certora Prover Documentation : Verification with ghosts
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Shelly</span>, last modified on May 22, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>(WIP)</p><p>In the last section, we presented the idea of ghosts for proving the invariant:</p><div class="ap-container" id="ap-orah-latex__orah-latex5985816629803891909">

  <div class="ap-content " id="embedded-orah-latex__orah-latex5985816629803891909"></div>
  <script class="ap-iframe-body-script">
  (function(){
    var data = {
    "addon_key":"orah-latex",
    "uniqueKey":"orah-latex__orah-latex5985816629803891909",
    "key":"orah-latex",
     "moduleType":"dynamicContentMacros",      "moduleLocation":"content",         "cp":"/wiki",
            "general":"",
    "w":"",
    "h":"",
    "url":"https://content-formatting.connect.apps.adaptavist.com/macro/latex/latex.html",
     "contextJwt": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI2MGZjMjVkNzhiMWE5YjAwNmYxNmFiZDAiLCJxc2giOiJjb250ZXh0LXFzaCIsImlzcyI6ImYwN2NmMjQ2LTk5NTktMzcyZS1hZTM0LTNmNWZhOTY3Nzk3YSIsImNvbnRleHQiOnsibGljZW5zZSI6eyJhY3RpdmUiOnRydWV9LCJjb25mbHVlbmNlIjp7ImVkaXRvciI6eyJ2ZXJzaW9uIjoiXCJ2MlwiIn0sIm1hY3JvIjp7Im91dHB1dFR5cGUiOiJodG1sX2V4cG9ydCIsImhhc2giOiIxZmYyOGVhNS1kNzg2LTRiZTItODQyMC1iMDBhZDhjODRiZDMiLCJpZCI6IjFmZjI4ZWE1LWQ3ODYtNGJlMi04NDIwLWIwMGFkOGM4NGJkMyJ9LCJjb250ZW50Ijp7InR5cGUiOiJwYWdlIiwidmVyc2lvbiI6IjMiLCJpZCI6IjQxMTI0MjkxIn0sInNwYWNlIjp7ImtleSI6IkNQRCIsImlkIjoiMjkxNjUyNSJ9fX0sImV4cCI6MTY0Mjc3ODE0MSwiaWF0IjoxNjQyNzc3MjQxfQ.8CHPdWn3TpNpnyP9CpRgCSE1j97dp4F573hvZDewEHM",    "structuredContext": "{\"license\":{\"active\":true},\"confluence\":{\"editor\":{\"version\":\"\\\"v2\\\"\"},\"macro\":{\"outputType\":\"html_export\",\"hash\":\"1ff28ea5-d786-4be2-8420-b00ad8c84bd3\",\"id\":\"1ff28ea5-d786-4be2-8420-b00ad8c84bd3\"},\"content\":{\"type\":\"page\",\"version\":\"3\",\"id\":\"41124291\"},\"space\":{\"key\":\"CPD\",\"id\":\"2916525\"}}}",
    "contentClassifier":"content",
    "productCtx":"{\"page.id\":\"41124291\",\"macro.hash\":\"1ff28ea5-d786-4be2-8420-b00ad8c84bd3\",\"space.key\":\"CPD\",\"user.id\":\"60fc25d78b1a9b006f16abd0\",\"page.type\":\"page\",\"content.version\":\"3\",\"page.title\":\"Verification with ghosts\",\"macro.localId\":\"\",\"macro.body\":\"$$\\n\\\\forall x. (map(x) \\\\neq 0 \\\\iff \\\\exists i. 0\\\\leq i \\\\leq keys.length \\\\land keys[i]=x)\\n$$\",\": = | RAW | = :\":null,\"space.id\":\"2916525\",\"macro.truncated\":\"false\",\"content.type\":\"page\",\"output.type\":\"html_export\",\"page.version\":\"3\",\"user.key\":\"8a7f808a7ad469f9017ad8f4037a0390\",\"content.id\":\"41124291\",\"macro.id\":\"1ff28ea5-d786-4be2-8420-b00ad8c84bd3\",\"editor.version\":\"\\\"v2\\\"\"}",
    "timeZone":"US/Eastern",
    "origin":"https://content-formatting.connect.apps.adaptavist.com",
    "hostOrigin":"https://certora.atlassian.net",
    "sandbox":"allow-downloads allow-forms allow-modals allow-popups allow-scripts allow-same-origin allow-top-navigation-by-user-activation allow-storage-access-by-user-activation",            "apiMigrations": {
        "gdpr": true
    }
}
;
    if(window.AP && window.AP.subCreate) {
      window._AP.appendConnectAddon(data);
    } else {
      require(['ac/create'], function(create){
        create.appendConnectAddon(data);
      });
    }
  }());
</script>
</div>
<p /><p>‌And we have already defined a ghost for the underlying map:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ghost _map(uint) returns uint;</pre>
</div></div><p>‌with the hooks:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">hook Sload uint v map[KEY uint k] STORAGE {
    require _map(k) == v;
}

hook Sstore map[KEY uint k] uint v STORAGE {
    havoc _map assuming _map@new(k) == v &amp;&amp;
        (forall uint k2. k2 != k =&gt; _map@new(k2) == _map@old(k2));
}</pre>
</div></div><p>‌We continue with defining two additional ghosts: one capturing the length of the array, and the second for remembering the elements of the array:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ghost array(uint) returns uint;ghost arrayLen() returns uint;</pre>
</div></div><p>‌We also define the hooks. For <code>array</code>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">hook Sload uint n keys[INDEX uint index] STORAGE {
    require array(index) == n;
}

hook Sstore keys[INDEX uint index] uint n STORAGE {
    havoc array assuming array@new(index) == n &amp;&amp;
        (forall uint i. i != index =&gt; array@new(i) == array@old(i));
}</pre>
</div></div><p>‌For <code>arrayLen</code>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">hook Sstore keys uint lenNew STORAGE {
    // the length of a solidity storage array is at the variable&#39;s slot
    havoc arrayLen assuming arrayLen@new() == lenNew;
}</pre>
</div></div><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jan 21, 2022 10:00</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
