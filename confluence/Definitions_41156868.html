<!DOCTYPE html>
<html>
    <head>
        <title>Certora Prover Documentation : Definitions</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Certora Prover Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Certora-Prover-Documentation_2916669.html">Certora Prover Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="The-Anatomy-of-a-Specification_238845999.html">The Anatomy of a Specification</a></span>
                            </li>
                                                    <li>
                                <span><a href="Ghosts_41156805.html">Ghosts</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Certora Prover Documentation : Definitions
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> thomas</span> on May 21, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="Definitions-Syntax"><strong>Syntax</strong></h1><p>Definitions are declared at the top-level of a specification and are in scope inside every rule, function and inside other definitions.</p><h2 id="Definitions-BasicDefinitions"><strong>Basic Definitions</strong></h2><p>The following shows the basic usage of definitions. The definitions bind parameters for use in an arbitrary expression on the right-hand side, which should evaluate to the declared return type. In the example below, <code>is_even</code> binds the variable <code>x</code> as a <code>uint256</code>. Definitions are applied just as any function would be.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">methods {
  foo(uint256) returns bool envfree
}​

definition MAX_UINT256() returns uint256 = 0xffffffffffffffffffffffffffffffff;
definition is_even(uint256 x) returns bool = exists y. 2 * y == x;​

rule my_rule(uint256 x) {
  require is_even(x) &amp;&amp; x &lt;= MAX_UINT256();
  foo@withrevert(x);    assert !lastReverted;
}​‌</pre>
</div></div><h2 id="Definitions-AdvancedDefinitions"><strong>Advanced Definitions</strong></h2><p>Beyond this basic functionality, definitions can do two things:</p><h3 id="Definitions-IncludeanApplicationofAnotherDefinition."><strong>Include an Application of Another Definition.</strong></h3><p>There can be arbitrarily deep nesting, however there must not be a circular dependency. The type checker will report an error if it detects a circular dependency. In the following example, <code>is_odd</code> and <code>is_odd_no_overflow</code> both reference other definitions:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">definition MAX_UINT256() returns uint256 = 0xffffffffffffffffffffffffffffffff;
definition is_even(uint256 x) returns bool = exists y. 2 * y == x;
definition is_odd(uint256 x) returns bool = !is_even(x);
definition is_odd_no_overflow(uint256 x) returns bool =
    is_odd(x) &amp;&amp; x &lt;= MAX_UINT256();</pre>
</div></div><p>The following examples would result in a type error due to a circular dependency:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// example 1
// cycle: is_even -&gt; is_odd -&gt; is_even
definition is_even(uint256 x) returns bool = !is_odd(x);
definition is_odd(uint256 x) returns bool = !is_even(x);​

// example 2
// cycle: circular1-&gt;circular2-&gt;circular3-&gt;circular1
definition circular1(uint x) returns uint = circular2(x) + 5;
definition circular2(uint x) returns uint = circular3(x - 2) + 7;
definition circular3(uint x) returns uint = circular1(x) + circular1(x);</pre>
</div></div><h3 id="Definitions-ReferenceGhostFunctions"><strong>Reference Ghost Functions</strong></h3><p>Definitions may reference ghost functions normally <em>or</em> in a <span class="inline-comment-marker" data-ref="20664348-44b2-4529-83f2-d83588bcd0c5">two state context</span>.</p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This means that definitions are not always &quot;pure&quot; but can affect ghosts which are a &quot;global&quot; construct.</p></div></div><p>The following is an example of a ghost used in a definition:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ghost foo(uint256 x) returns uint256;​

definition is_even(uint256 x) returns bool = exists y. 2 * y == x;
definition foo_is_even_at(uint256 x) = is_even(foo(x));​

rule rule_assuming_foo_is_even_at(uint256 x) {
  require foo_is_even_at(x);
  ...
}</pre>
</div></div><p>More interestingly, we can use the two-context version of ghosts in a definition (adding the <code>@new</code> or <code>@old</code> annotations. If we use the two-context version of a ghost, we <em>may not</em> use the ghost <em>without</em> an <code>@new</code> or <code>@old</code> annotation. Additionally, that definition <em>must</em> be used in a <span class="inline-comment-marker" data-ref="2aa48932-c7df-4e05-8736-0ed153e55a1b">two state context</span> for that ghost function (i.e., at the right side of a <code>havoc assuming</code> statement for that ghost)<span class="inline-comment-marker" data-ref="30bcc26e-bd57-4adf-a501-832e8e14c66d">.</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">ghost foo(uint256 x) returns uint256;​

definition is_even(uint256 x) returns bool = exists y. 2 * y == x;
definition foo_add_even(uint256 x) returns bool = is_even(foo@new(x)) &amp;&amp;
    forall uint256 a. is_even(foo@old(x)) =&gt; is_even(foo@new(x));
    
​rule rule_assuming_old_evens(uint256 x) {
  // havoc foo, assuming all old even entries are still even, and that
  // the entry at x is also even
  havoc foo assuming foo_add_even(x);
  ...
}</pre>
</div></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The type checker will tell you if you have used a two-state version of a variable when you should not have</p></div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jan 21, 2022 10:00</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
